{% extends "base.html" %}
{% load frontpage_tags %}

{% block title %}{{ object.get_verbose_name.grandprix }} {{ object.grandprix.name }} {{ object.grandprix.season.year }} | F1Online.Ru{% endblock %}
{% block content_title %}{% endblock %}

{% block inner_breadcrumbs %}
	<div id="breadcrumbs-wrap">
		<div id="breadcrumbs">
			<a href="/" class="home">F1Online.Ru</a> /
			<a href="">Энциклопедия</a> / 
			<a href="{% url season_detail object.grandprix.season.id %}">Сезон {{ object.grandprix.season.year }}</a> / 
			<a href="{% url grand_prix_detail object.grandprix.id %}">{{ object.get_verbose_name.grandprix }} {{ object.grandprix.name }}</a> / 
			<span>{{ object.get_type_display }}</span>
		</div> 
	</div>
{% endblock %}

{% block content %}
	<div id="heat-detail">
	    <h2>{{ object.get_verbose_name.grandprix }} {{ object.grandprix.name }} {{ object.grandprix.season.year }}</h2>
	    <h3>{{ object.get_type_display }}</h3>
	     
	    {% for result in object.get_results %}
		    {% if forloop.first %}
		    <table>
		        <tr>
		            <th class="narrow">{{ result.get_verbose_name.position }}</th>
		            <th class="narrow">{{ result.get_verbose_name.num }}</th>
		            <th class="narrow">Нац.</th>
		            <th>{{ result.get_verbose_name.racer }}</th>
		            <th>{{ result.get_verbose_name.team }}</th>
		            <th>{{ result.get_verbose_name.engine }}</th>
		            <th>{{ result.get_verbose_name.tyre }}</th>
		            <th>Время</th>
		            {% if object.type != 'R' %}
		            	<th>Отставание</th>
	            	{% endif %}
	                {% if object.type == 'B' %}
	                    <th>Круг</th>
	                {% endif %}
	                {% if object.type = 'R' %}
		            	<th>&nbsp;</th>
	            	{% endif %}
		        </tr>
		    {% endif %}
	        <tr>
	            {% if result.is_classified %}
	                {% if result.dsq %}
	            		<td class="center nc narrow">DSQ</td>
	           		{% else %}
	                	<td class="center narrow">{{ result.position }}</td>
	               	{% endif %}
	            {% else %}
	               	<td class="center nc narrow">NC</td>
	            {% endif %}
	            <td class="center narrow">{{ result.num }}</td>
	            <td class="center narrow"><span class="flag {{ result.racer.country.en_name|slugify }}"></span></td>
	            <td><a href="{% url racer_detail result.racer.slug %}">{{ result.racer }}</a></td>
	            <td>{{ result.team }}</td>
	            <td>{{ result.engine }}</td>
	            <td class="center"><abbr title="{{ result.tyre }}">{{ result.tyre.name|slice:":1" }}</abbr></td>
	            <td class="center">
	            	{% if object.type == 'R' %}
		            	{% if result.position == 1 %}
	            			{{ result.get_time_display }} 
	        			{% else %}
	        				{{ result.get_delta_display }}
	    				{% endif %}
    				{% else %}
                        {% if result.get_time_display %}               
        					{{ result.get_time_display }}
                        {% else %}
                            -
                        {% endif %}
    				{% endif %}
            	</td>
            	{% if object.type != 'R' %}
            		<td>{{ result.get_delta_display }}</td>
            	{% endif %}
                {% if object.type == 'B' %}
                    <td class="center">
	                    {% if result.position == 1 %}
	                        {{ object.laps }}
	                    {% else %}
	                        {{ result.laps }}
	                    {% endif %}
                    </td>
                {% endif %}
	            {% if object.type == 'R' %}
            		<td>{{ result.retire.reason }}</td>
           		{% endif %}
	        </tr>
	    {% endfor %}
		
		
		{% if object.type == 'R' %}
			<tr>
				<td colspan="9" class="not-classified">
					<h4>Не классифицированы</h4>
				</td>
			</tr>
			<tr>
				<th class="center narrow">#</th>
				<th class="narrow">№</th>
				<th class="narrow">Нац.</th>
				<th>Гонщинк</th>
				<th>Команда</th>
				<th>Двигатель</th>
				<th>Шины</th>
				<th>Круг схода</th>
				<th>Причина схода</th>
			</tr>
		    {% for result in object.get_fails %}
		        <tr>
		            {% if result.is_classified %}
		                {% if result.dsq %}
		            		<td class="center nc narrow">DSQ</td>
		           		{% else %}
		                	<td class="center narrow">{{ result.position }}</td>
		               	{% endif %}
		            {% else %}
		            	{% if result.dsq %}
		            		<td class="center nc narrow">DSQ</td>
		           		{% else %}
		                	<td class="center nc narrow">NC</td>
		               	{% endif %}
		            {% endif %}
		            <td class="center narrow">{{ result.num }}</td>
		            <td class="center narrow"><span class="flag {{ result.racer.country.en_name|slugify }}">{{ result.racer.country }}</span></td>
		            <td><a href="{% url racer_detail result.racer.slug %}">{{ result.racer }}</a></td>
		            <td>{{ result.team }}</td>
		            <td>{{ result.engine }}</td>
		            <td class="center"><abbr title="{{ result.tyre }}">{{ result.tyre.name|slice:":1" }}</abbr></td>
		            <td class="center">{{ result.get_lap_display }}</td>
		            <td>{{ result.retire.reason }}</td>
		        </tr>
		    {% endfor %}
	    {% endif %}
	    </table>
	    
	    {% if object.type == 'R' %}
			{% show_fastest_lap object.grandprix %}
		{% endif %}
    </div>
{% endblock %}


{% block sidebar %}
	<aside class="heats">
		<div>{{ object.get_verbose_name.date }}: {{ object.date|date:"d.m.Y" }}</div>
	    <div>{{ object.grandprix.tracklen.track }}</div>
	    <div>{{ object.grandprix.tracklen.get_verbose_name.length }}: {{ object.grandprix.tracklen.length }}</div>
	    <div>{{ object.get_verbose_name.laps }} : {{ object.laps }}</div>
	    <em>{{ object.get_speed|floatformat:"3" }} км/ч</em>
	</aside>
{% endblock %}
